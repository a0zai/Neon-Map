<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Live Thermal Gradient</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000;
            margin: 0;
            color: white;
            font-family: sans-serif;
            flex-direction: column;
        }
        canvas {
            border: 2px solid white;
        }
        h1 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>ðŸ«£</h1>
    <video id="camera" autoplay playsinline width="640" height="480" style="display:none;"></video>
    <canvas id="output" width="640" height="480"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>

    <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('output');
    const ctx = canvas.getContext('2d');

    navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => { video.srcObject = stream; })
        .catch(err => console.error(err));

    async function runThermalGradient() {
        const net = await bodyPix.load();

        async function frameLoop() {
            const segmentation = await net.segmentPerson(video, {
                flipHorizontal: false,
                internalResolution: 'medium',
                segmentationThreshold: 0.7
            });

            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            let data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                let pixelIndex = i / 4;
                let maskVal = segmentation.data[pixelIndex];

                if (maskVal === 1) {
                    let heat = Math.floor(Math.random() * 55) + 200; // 200-255
                    data[i] = heat;          // R
                    data[i + 1] = Math.floor(heat * 0.4); // G Ø£Ù‚Ù„
                    data[i + 2] = 0;         // B ØµÙØ±
                } else {
                    data[i] = 0;
                    data[i + 1] = 0;
                    data[i + 2] = 100;
                }
            }

            ctx.putImageData(imageData, 0, 0);
            requestAnimationFrame(frameLoop);
        }

        frameLoop();
    }

    runThermalGradient();
    </script>
</body>
</html>