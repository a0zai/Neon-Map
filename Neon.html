<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Spraak Navigatie Assistent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="background:#000;color:#fff;font-size:1.5em;text-align:center;">
  <p>Druk ergens op het scherm om de microfoon te activeren.</p>

<script>
let started = false;

// ðŸŽ™ï¸ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ
function speak(text, callback){
  speechSynthesis.cancel();
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "nl-NL";
  msg.rate = 1;
  msg.pitch = 1;

  const voices = speechSynthesis.getVoices();
  const humanVoice = voices.find(v => v.lang==="nl-NL" && v.name.toLowerCase().includes("google")) || voices[0];
  if(humanVoice) msg.voice = humanVoice;

  msg.onend = callback;
  speechSynthesis.speak(msg);
}

// ðŸŽ§ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
function startListening(){
  if(!('webkitSpeechRecognition' in window)){
    speak("Deze browser ondersteunt geen spraakherkenning.");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang="nl-NL";
  recognition.continuous=false;
  recognition.interimResults=false;
  recognition.start();

  recognition.onresult = async (event)=>{
    const destination = event.results[0][0].transcript;
    speak("Ik zoek naar " + destination);

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… OpenStreetMap API Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„ÙˆØ¬Ù‡Ø©
    try {
      const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(destination)}`);
      const data = await res.json();
      if(data && data[0]){
        const destLat = parseFloat(data[0].lat);
        const destLng = parseFloat(data[0].lon);

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        if(navigator.geolocation){
          navigator.geolocation.getCurrentPosition(pos=>{
            const userLat = pos.coords.latitude;
            const userLng = pos.coords.longitude;

            navigate(userLat,userLng,destLat,destLng);
          });
        }
      } else {
        speak("Ik kon de locatie niet vinden.");
      }
    } catch(e){
      console.log(e);
      speak("Er is een fout opgetreden bij het zoeken naar de bestemming.");
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹
    setTimeout(startListening,1500);
  };

  recognition.onerror = ()=>{
    speak("Ik heb u niet goed verstaan.", ()=>setTimeout(startListening,1500));
  };
}

// ðŸ§­ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¨Ø§Ù„Ø³Ø§Ø¹Ø©
function navigate(userLat,userLng,destLat,destLng){
  function getDistance(lat1,lon1,lat2,lon2){
    const R = 6371000;
    const toRad = x => x*Math.PI/180;
    const dLat = toRad(lat2-lat1);
    const dLon = toRad(lon2-lon1);
    const a = Math.sin(dLat/2)**2 + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)**2;
    const c = 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    return R*c;
  }

  function getClockDirection(lat1,lon1,lat2,lon2){
    const toDeg = x => x*180/Math.PI;
    const y = Math.sin(lon2-lon1)*Math.cos(lat2);
    const x = Math.cos(lat1)*Math.sin(lat2)-Math.sin(lat1)*Math.cos(lat2)*Math.cos(lon2-lon1);
    let brng = (toDeg(Math.atan2(y,x))+360)%360;
    const hour = Math.round(brng/30)||12;
    return hour;
  }

  const distance = Math.round(getDistance(userLat,userLng,destLat,destLng));
  const hour = getClockDirection(userLat,userLng,destLat,destLng);

  if(distance>10){
    speak(`Na ${distance} meter, sla af bij uur ${hour}`, ()=>{
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
      navigator.geolocation.getCurrentPosition(pos=>{
        navigate(pos.coords.latitude,pos.coords.longitude,destLat,destLng);
      });
    });
  } else {
    speak("U bent aangekomen op uw bestemming.");
  }
}

// ðŸ‘† Ø£ÙˆÙ„ Ù†Ù‚Ø±Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
document.body.addEventListener("click",()=>{
  if(started) return;
  started=true;
  speak("Toestemming gevraagd. Zeg nu uw bestemming.", ()=>startListening());
});

// ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø£ÙˆÙ„ÙŠØ©
window.onload = ()=>{ speak("Tik Ã©Ã©n keer in het midden van het scherm om de microfoon toe te staan."); };
</script>

</body>
</html>